!function(t,o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof exports?module.exports=o(require("jquery")):t.IdleTimeoutPlus=o(t.jQuery)}(this,function(t){function o(){null===F&&(F=Storages.localStorage?Storages.initNamespaceStorage("jqueryIdleTimeoutPlus").localStorage:{})}function n(t,o){J.multiWindowSupport?F.set(t,o):F[t]=o}function e(t,o){if(o="undefined"==typeof o?null:o,J.multiWindowSupport){if(F.isSet(t))return F.get(t)}else if(t in F)return F[t];return o}function l(){n("warningStartTime",-1),n("lockStartTime",-1),i(),J.idleCallback!==!1&&J.idleCallback(J)}function i(){a(),n("lastActivity",t.now()),Z=setInterval(r,J.idleCheckHeartbeat)}function a(){clearInterval(Z)}function r(){var o=e("lastActivity",t.now())+J.idleTimeLimit;return e("logoutTriggered")===!0?N():e("lockStartTime",-1)!==-1?(a(),L()):t.now()>=o?(a(),J.warnEnabled?d():J.lockEnabled?A():O()):void 0}function c(){t(document).on(J.activityEvents,function(t){if("mousemove"===t.type){if(t.clientX===ot[0]&&t.clientY===ot[1])return;ot[0]=t.clientX,ot[1]=t.clientY}e("warningStartTime",-1)===-1&&e("lockStartTime",-1)===-1&&i()})}function u(){s(),$=setInterval(function(){t.ajax({type:J.keepAliveAjaxType,url:J.keepAliveUrl,data:J.keepAliveAjaxData,success:function(o){J.keepAliveResponse!==!1&&t.trim(o)!==J.keepAliveResponse&&window.location.replace(J.keepAliveBadUrl)}})},J.keepAliveInterval)}function s(){clearInterval($)}function d(){k(),J.warnCallback!==!1&&(nt=J.warnCallback(J)),m()}function p(){f(),v(),n("warningStartTime",-1),l()}function k(){n("warningStartTime",t.now()),_=setInterval(w,500)}function f(){clearInterval(_)}function w(){if(e("logoutTriggered")===!0)return f(),N();if(e("warningStartTime",-1)===-1)return p();var o=e("warningStartTime")+J.warnTimeLimit-1;return t.now()>=o?(f(),J.lockEnabled?(v(),A()):O()):void b()}function m(){nt&&(g(),b(),J.bootstrap?(lt.modal("show"),lt.focus()):lt.dialog("open"),et=!0)}function v(){et=!1,null!==lt&&(J.bootstrap?(lt.modal("hide"),z.removeClass("modal-open"),t("div.modal-backdrop").remove()):lt.dialog("close"))}function b(){if(null!==lt&&(null!==it||null!==at)){var o=t.now(),n=Math.floor((e("warningStartTime",o)+J.warnTimeLimit-o)/1e3);if(null!==it&&it.html(X(n)),null!==at){var l=Math.floor(n/(J.warnTimeLimit/1e3)*100);J.bootstrap?at.css("width",l+"%"):at.progressbar("value",l)}}}function g(){if(null===lt){var t="";t=J.warnContentCallback===!1?J.bootstrap?h():j():J.warnContentCallback(J),J.bootstrap?y(t):T(t)}}function y(o){z.append(o),null!==J.warnLogoutButton&&t("#jitp-warn-logout").on("click",function(){C()}),t("#jitp-warn-alive").on("click",function(){S()}),lt=t("#jitp-warn-display"),(null!==J.warnCountdownMessage||J.warnCountdownBar)&&(it=lt.find(".jitp-countdown-holder")),J.warnCountdownBar&&(at=t("#jitp-warn-bar"))}function T(o){var n=[];null!==J.warnLogoutButton&&n.push({text:J.warnLogoutButton,click:function(){C()}}),n.push({text:J.warnStayAliveButton,click:function(){S()}}),t(o).dialog({buttons:n,closeOnEscape:!1,modal:!0,title:J.warnTitle,minWidth:320,autoOpen:!1,open:function(){null===J.warnTitle?t(this).closest(".ui-dialog").find(".ui-dialog-titlebar").hide():t(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide(),t(this).parent().find("button:nth-child(2)").focus()}}),lt=t("#jitp-warn-display"),null!==J.warnCountdownMessage&&(it=lt.find(".jitp-countdown-holder")),J.warnCountdownBar&&(at=t("#jitp-warn-bar"),at.progressbar({value:0,max:100}))}function h(){var t=null===J.warnTitle?"":'<div class="modal-header"><h4 class="modal-title">'+J.warnTitle+"</h4></div>",o=null===J.warnCountdownMessage?"":"<p>"+J.warnCountdownMessage.replace(/\{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>",n=null===J.warnLogoutButton?"":'<button id="jitp-warn-logout" type="button" class="btn btn-default">'+J.warnLogoutButton+"</button>",e=null===J.warnCountdownBar?"":'<div class="progress"><div id="jitp-warn-bar" class="progress-bar progress-bar-striped active" role="progressbar" style="min-width: 15px; width: 100%;"><span class="jitp-countdown-holder"></span></div></div>';return'<div class="modal fade" id="jitp-warn-display" data-backdrop="static" data-keyboard="false" tabindex="-1"><div class="modal-dialog"><div class="modal-content">'+t+'<div class="modal-body"><p>'+J.warnMessage+"</p>"+o+e+'</div><div class="modal-footer">'+n+'<button id="jitp-warn-alive" type="button" class="btn btn-primary">'+J.warnStayAliveButton+"</button></div></div></div></div>"}function j(){var t=null===J.warnCountdownMessage?"":"<p>"+J.warnCountdownMessage.replace(/\{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>",o=null===J.warnCountdownBar?"":'<div id="jitp-warn-bar"></div>';return'<div id="jitp-warn-display"><p>'+J.warnMessage+"</p>"+t+o+"</div>"}function C(){f(),D()}function S(){p()}function A(){J.lockHaltKeepAlive&&s(),M(),J.lockCallback!==!1&&(rt=J.lockCallback(J)),x()}function L(){J.lockHaltKeepAlive?s():J.keepAliveInterval&&u(),e("lockStartTime",-1)===-1?M():tt=setInterval(I,500),x()}function U(){B(),E(),t("#jitp-lock-pass").val(""),J.keepAliveInterval&&u(),n("lockStartTime",-1),l()}function M(){n("lockStartTime",t.now()),tt=setInterval(I,500)}function B(){clearInterval(tt)}function I(){if(e("logoutTriggered")===!0)return B(),N();if(e("lockStartTime",-1)===-1)return U();var o=e("lockStartTime")+J.lockTimeLimit-1;return t.now()>=o?(B(),e("logoutTriggered")===!0?N():O()):void q()}function x(){if(rt){W(),q();var o={message:t("#jitp-lock-display")};o=t.extend(o,J.lockBlockUiConfig),t.blockUI(o),ct=!0}}function E(){t.unblockUI(),ct=!1}function q(){if(null!==st){var o=t.now(),n=Math.floor((e("lockStartTime",o)+J.lockTimeLimit-o)/1e3);st.html(X(n))}}function W(){if(null===ut){var o="";o=J.lockContentCallback===!1?J.bootstrap?P():H():J.lockContentCallback(J),z.append(o),ut=t("#jitp-lock-display"),J.lockCountdownMessage!==!1&&(st=ut.find(".jitp-countdown-holder")),t("#jitp-lock-logout").on("click",function(){K()}),t("#jitp-lock-unlock").on("click",function(){R()}),t("#jitp-lock-form").length&&t("#jitp-lock-form").submit(function(){return R(),!1}),q()}}function P(){var t=null===J.lockTitle?"":'<div class="panel-heading"><h2 class="panel-title">'+J.lockTitle+"</h2></div>",o=J.lockLogoutButton.replace(/\{username}/g,J.lockUsername),n=null===J.lockCountdownMessage?"":'<div class="panel-footer">'+J.lockCountdownMessage.replace(/\{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</div>";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;"><div class="panel panel-default jitp-lock-panel">'+t+'<div class="panel-body"><h4>'+J.lockUsername+"</h4><p>"+J.lockMessage+'</p><div class="input-group"><input id="jitp-lock-pass" type="password" class="form-control" placeholder="Password..."/><span class="input-group-btn"><button id="jitp-lock-unlock" class="btn btn-primary" type="button">'+J.lockUnlockButton+'</button></span></div><a id="jitp-lock-logout" href="javascript:;">'+o+"</a></div>"+n+"</div></div>"}function H(){var t=null===J.lockTitle?"":"<header>"+J.lockTitle+"</header>",o=J.lockLogoutButton.replace(/\{username}/g,J.lockUsername),n=null===J.lockCountdownMessage?"":"<footer>"+J.lockCountdownMessage.replace(/\{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</footer>";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;"><div class="jitp-lock-panel jitp-lock-jqpanel">'+t+'<div class="jitp-lock-jqpanel-body"><h2>'+J.lockUsername+"</h2><p>"+J.lockMessage+'</p><div><input id="jitp-lock-pass" type="text" class="form-control" placeholder="Password..."/></div><button id="jitp-lock-unlock" type="button">'+J.lockUnlockButton+'</button><a id="jitp-lock-logout" href="javascript:;">'+o+"</a></div>"+n+"</div></div>"}function K(){B(),D()}function R(){J.lockPassCallback(t("#jitp-lock-pass").val())}function Y(){s(),a(),f(),B()}function D(){Y(),n("logoutTriggered",!0),("function"!=typeof J.logoutCallback||J.logoutCallback(J))&&window.location.replace(J.logoutUrl)}function N(){Y(),("function"!=typeof J.logoutAutoCallback||J.logoutAutoCallback(J))&&window.location.replace(J.logoutAutoUrl)}function O(){return Y(),J.multiWindowSupport?void setTimeout(Q,G(100,500)):Q()}function Q(){return e("logoutTriggered",!1)?N():(n("logoutTriggered",!0),void(("function"!=typeof J.redirectCallback||J.redirectCallback(J))&&window.location.replace(J.redirectUrl)))}function X(t){var o=Math.floor(t/60);if(o<=15){var n=t%60,e=o>0?o+"m ":"";return e+=n+"s"}if(o<=75)return o<=22?"about 15 mins":o<=37?"about 30 mins":o<=52?"about 25 mins":"about 1 hour";var l=Math.floor(o/60);return o%=60,o<=15?"about "+l+" hours":o>52?"about "+(l+1)+" hours":"about "+l+"&frac12; hours"}function G(t,o){return Math.floor(Math.random()*(o-t))+t}var J={idleTimeLimit:1200,idleCallback:!1,idleCheckHeartbeat:2,bootstrap:!1,activityEvents:"click keypress scroll wheel mousewheel mousemove touchmove",warnEnabled:!0,warnTimeLimit:180,warnCallback:!1,warnContentCallback:!1,warnTitle:"Session Timeout",warnMessage:"Your session is about to expire!",warnStayAliveButton:"Stay Connected",warnLogoutButton:"Logout",warnCountdownMessage:"Time remaining: {timer}",warnCountdownBar:!1,redirectUrl:"/timed-out",logoutUrl:"/logout",logoutAutoUrl:null,redirectCallback:!1,logoutCallback:!1,logoutAutoCallback:!1,keepAliveInterval:600,keepAliveUrl:window.location.href,keepAliveAjaxType:"GET",keepAliveAjaxData:"",keepAliveResponse:!1,keepAliveBadUrl:window.location.href,lockEnabled:!1,lockTimeLimit:7200,lockHaltKeepAlive:!0,lockCallback:!1,lockContentCallback:!1,lockPassCallback:!1,lockTitle:null,lockUsername:"System User",lockMessage:"Enter your password to unlock the screen",lockUnlockButton:"UnLock",lockLogoutButton:"Not {username} ?",lockCountdownMessage:"Auto-logout in: {timer}",lockBlockUiConfig:{},lockLoadActive:!1,multiWindowSupport:!1},z=t("body"),F=null,V={};V.start=function(l){if(J=t.extend(J,l),null==J.logoutAutoUrl&&(J.logoutAutoUrl=J.logoutUrl),J.idleTimeLimit*=1e3,J.idleCheckHeartbeat*=1e3,J.warnTimeLimit*=1e3,J.lockTimeLimit*=1e3,J.keepAliveInterval*=1e3,J.multiWindowSupport&&!Storages.localStorage)return console.error("jitp: Multi-Window support requested but JS Storage is unavailable."),!1;if(J.warnEnabled&&J.warnCallback===!1||J.lockEnabled&&J.lockCallback===!1)if(J.bootstrap){if("undefined"==typeof t.fn.modal)return console.error("jitp: Bootstrap library is unavailable"),!1}else if("undefined"==typeof t.ui)return console.error("jitp: jQueryUI library is unavailable"),!1;if(J.lockEnabled&&!J.multiWindowSupport)return console.error("jitp: Lock screen requested but multi-window support is not enabled."),!1;if(J.lockEnabled&&J.lockCallback===!1){if("undefined"==typeof t.blockUI)return console.error("jitp: Lock screen requested but blockUI library is unavailable."),!1;if(J.lockPassCallback===!1)return console.error("jitp: Lock screen requested but lockPassCallback function is not set."),!1}return o(),J.lockEnabled&&(J.lockLoadActive||e("lockStartTime",-1)>0)?L():(n("logoutTriggered",!1),n("warningStartTime",-1),n("lockStartTime",-1),n("lastActivity",t.now()),i(),J.keepAliveInterval&&u()),J.keepAliveInterval&&u(),c(),!0},V.cleanUpLockScreen=function(){o(),Storages.localStorage&&F.set("lockStartTime",-99)},V.logout=function(){D()},V.displayWarning=function(){m()},V.displayLockScreen=function(){x()},V.initLockScreen=function(){a(),f(),A()},V.setIdleTimeLimit=function(t){"number"==typeof t&&(J.idleTimeLimit=1e3*t,V.rollback())},V.setWarnTimeLimit=function(t){"number"==typeof t&&(J.warnTimeLimit=1e3*t,V.rollback())},V.setLockTimeLimit=function(t){"number"==typeof t&&(J.lockTimeLimit=1e3*t,V.rollback())},V.rollback=function(){U(),p()};var Z,$,_,tt,ot=[-1,-1],nt=!0,et=!1,lt=null,it=null,at=null,rt=!0,ct=!1,ut=null,st=null;return V});